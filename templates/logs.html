<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Log Viewer</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        h1 { color: #333; }
        .log-container { background-color: #f4f4f4; border: 1px solid #ddd; padding: 10px; }
        .log-entry { 
            font-family: ui-serif; 
            margin-bottom: 1px; /* 保持间距为0 */
            padding: 2px; /* 轻微的内边距 */
        }
        .highlight { 
            color: red; /* 设置文本颜色为红色 */
        }
    </style>
</head>
<body>
    <div id="game-info-container">
        <h2>Game Information</h2>
        <p id="game-id">Game ID: <span></span></p>
        <p id="pool-amount">Pool Amount: <span></span></p>
        <p id="player-amount">Player Amount: <span></span></p>
        <p id="game-time">Game Time: <span></span></p>
    </div>
    <h1>Recent Log Entries</h1>
    <div class="log-container">
        {% for line in logs %}
            <div class="log-entry" id="log-entry-{{ loop.index }}">
                {{ line }}
            </div>
        {% endfor %}
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var entries = document.querySelectorAll('.log-entry');
            entries.forEach(function(entry) {
                if (entry.textContent.includes('game_logic')) {
                    entry.classList.add('highlight');
                }
            });

            // Establish WebSocket connection using wss:// protocol
            var ws = new WebSocket('wss://api.balaton.bet/ws/gameinfo');
            ws.onopen = function() {
                console.log('WebSocket connection established');
                setInterval(function() {
                    ws.send('request_gameinfo');  // Request game info every 1 second
                }, 1000);
            };
            ws.onmessage = function(event) {
                var gameInfo = JSON.parse(event.data);
                document.querySelector('#game-id span').textContent = gameInfo.game_id;
                document.querySelector('#pool-amount span').textContent = gameInfo.pool_amount;
                document.querySelector('#player-amount span').textContent = gameInfo.player_amount;
                document.querySelector('#game-time span').textContent = gameInfo.game_time;
            };
            ws.onclose = function() {
                console.log('WebSocket connection closed');
            };
            ws.onerror = function(error) {
                console.error('WebSocket error:', error);
            };
        });
    </script>
</body>
</html>